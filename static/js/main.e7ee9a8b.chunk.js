(this["webpackJsonpmovies-app"]=this["webpackJsonpmovies-app"]||[]).push([[0],{172:function(e,t,n){},333:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),s=n(27),i=n.n(s),c=n(8),o=n(14),u=n(16),h=n(18),l=n(17),g=(n(123),n(172),a.a.createContext()),p=g.Provider,d=g.Consumer,b=n(344),f=n(340),j=n(10),m=b.a.Header,v=function(e){var t=e.onInputChange;return Object(j.jsx)(m,{children:Object(j.jsx)(f.a,{placeholder:"Type to search...",onChange:t})})},O=n(22),y=n.n(O),x=n(37),L=function(){function e(){Object(o.a)(this,e),this.apiKey="162123c84167fbeaf28191b62529a99d",this.baseStr="https://api.themoviedb.org/3/",this.token=JSON.parse(localStorage.getItem("guestToken")),this.requestGet=function(e){return fetch(e).then((function(t){if(!t.ok)throw new Error("error fetch URL ".concat(e,", response status ").concat(t.status));return t.json()}))}}return Object(u.a)(e,[{key:"creatGuestSession",value:function(){var e=Object(x.a)(y.a.mark((function e(){var t,n,r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new URL("".concat(this.baseStr,"authentication/guest_session/new"))).searchParams.set("api_key",this.apiKey),e.next=4,this.requestGet(t);case 4:return n=e.sent,r=n.guest_session_id,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMovies",value:function(){var e=Object(x.a)(y.a.mark((function e(t,n){var r,a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new URL("".concat(this.baseStr,"search/movie"))).searchParams.set("api_key",this.apiKey),r.searchParams.set("query",t),r.searchParams.set("page",n),e.next=6,this.requestGet(r);case 6:return a=e.sent,e.abrupt("return",{totalPages:a.total_pages,list:a.results});case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getGenres",value:function(){var e=Object(x.a)(y.a.mark((function e(){var t,n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new URL("".concat(this.baseStr,"genre/movie/list"))).searchParams.set("api_key",this.apiKey),e.next=4,this.requestGet(t);case 4:return n=e.sent,e.abrupt("return",n.genres);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"rateFilm",value:function(){var e=Object(x.a)(y.a.mark((function e(t,n){var r,a,s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new URL("".concat(this.baseStr,"movie/").concat(t,"/rating"))).searchParams.set("api_key",this.apiKey),r.searchParams.set("guest_session_id",this.token),a={value:n},s={"Content-Type":"application/json;charset=utf-8"},e.next=7,fetch(r,{method:"POST",body:JSON.stringify(a),headers:s}).catch((function(e){console.log(e)}));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteRateFilm",value:function(){var e=Object(x.a)(y.a.mark((function e(t){var n,r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new URL("".concat(this.baseStr,"movie/").concat(t,"/rating"))).searchParams.set("api_key",this.apiKey),n.searchParams.set("guest_session_id",this.token),r={"Content-Type":"application/json;charset=utf-8"},e.next=6,fetch(n,{method:"DELETE",headers:r});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRatedFilms",value:function(){var e=Object(x.a)(y.a.mark((function e(){var t,n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new URL("".concat(this.baseStr,"guest_session/").concat(this.token,"/rated/movies"))).searchParams.set("api_key",this.apiKey),e.next=4,this.requestGet(t);case 4:return n=e.sent,e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),k=new L,w=n.p+"static/media/no-pictures.5533b14a.png",P=n(338),R=function(e){return Object(P.a)(new Date(e),"MMM Q, y")},S=n(343),C=n(342),_=function(e){Object(h.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).movieGenreList=function(t){return t.map((function(t){return e.props.genresList.find((function(e){return e.id===t})).name}))},e.shortenText=function(e,t){if(e.length>t){if(" "===e.substring(t-1,t))return e.substring(0,t)+"...";var n=e.substring(0,t).lastIndexOf(" ");return e.substring(0,n)+"..."}return e},e.rating\u0421hanges=function(t){var n=e.props.item.id;0===t?k.deleteRateFilm(n):k.rateFilm(n,t),e.props.changeRateList()},e.defineRating\u0421olor=function(e){var t;return e<=3?t="#E90000":e<=5?t="#E97E00":e<=7?t="#E9D100":e>7&&(t="#66E900"),{borderColor:t}},e.showPoster=function(e){return null!==e?"https://image.tmdb.org/t/p/w200/".concat(e):w},e.checkMovieInRated=function(e,t,n){var r=0;return n?r=n:t.forEach((function(t){if(t.id===e)return r=t.rating})),r},e}return Object(u.a)(n,[{key:"render",value:function(){var e=this.props.rateList,t=this.props.item,n=t.title,r=t.poster_path,s=t.overview,i=t.release_date,c=t.genre_ids,o=t.vote_average,u=t.rating,h=t.id,l=this.checkMovieInRated(h,e,u),g=this.showPoster(r),p=this.shortenText(s,180),d=this.shortenText(n,30),b=i?R(i):null,f=this.defineRating\u0421olor(o),m=this.movieGenreList(c),v=Object(j.jsx)(a.a.Fragment,{children:m.map((function(e){return Object(j.jsx)("span",{className:"ant-card-body_genre-item",children:e},e)}))});return Object(j.jsxs)(S.a,{className:"ant-card",hoverable:!0,cover:Object(j.jsx)("img",{alt:"poster",src:g}),children:[Object(j.jsx)("div",{style:f,className:"ant-card-body_rating",children:o}),Object(j.jsx)("div",{className:"ant-card-body_title",children:d}),Object(j.jsx)("div",{className:"ant-card-body_data",children:b}),Object(j.jsx)("div",{className:"ant-card-body_genres",children:v}),Object(j.jsxs)("p",{className:"ant-card-body_text",children:[" ",p]}),Object(j.jsx)("div",{className:"ant-card-body_genre-stars",children:Object(j.jsx)(C.a,{defaultValue:l,count:10,onChange:this.rating\u0421hanges})})]})}}]),n}(r.Component),N=n(345),T=n(337),E=function(){return Object(j.jsx)(N.b,{size:"large",children:Object(j.jsx)(T.a,{size:"large",className:"loader"})})},F=n(341),G=n(339),I=n(101),Q=n(160),K=function(e){Object(h.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={moviesList:[],loading:!1,error:!1,notFound:!1,totalPages:null},e.getList=function(t,n){k.getMovies(t,n).then((function(t){e.setState({moviesList:Object(c.a)(t.list),loading:!1,error:!1,totalPages:t.totalPages})})).then((function(){0===e.state.moviesList.length&&e.setState({notFound:!0})})).catch(e.onError)},e.debouncedGetList=Object(Q.debounce)(e.getList,500),e.onError=function(){e.setState({error:!0,loading:!1})},e}return Object(u.a)(n,[{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.searchQuery,r=t.numberPage;n===e.searchQuery&&r===e.numberPage||(this.setState({loading:!0,error:!1,notFound:!1}),this.debouncedGetList(n,r))}},{key:"render",value:function(){var e=this.state,t=e.moviesList,n=e.loading,r=e.error,s=e.notFound,i=e.totalPages,c=this.props,o=c.searchQuery,u=c.numberPage,h=c.onPageChange,l=c.changeRateList,g=c.rateList,p=r&&""!==o?Object(j.jsx)(F.a,{message:"Error",description:"Oops, something went wrong :-(",type:"error",showIcon:!0}):null,b=r||n||!s?null:Object(j.jsx)(F.a,{message:"No results were found for your search!",type:"info",showIcon:!0}),f=n?Object(j.jsx)(E,{}):null,m=n||r?null:Object(j.jsx)(d,{children:function(e){return Object(j.jsx)(a.a.Fragment,{children:t.map((function(t){var n=t.id;return Object(j.jsx)(_,{item:t,genresList:e,changeRateList:l,rateList:g},n)}))})}}),v=i>5,O=10*i,y=0===t.length||""===o||n?null:Object(j.jsx)(G.a,{size:"small",showQuickJumper:v,defaultCurrent:u,total:O,onChange:h,showSizeChanger:!1});return Object(j.jsxs)(a.a.Fragment,{children:[Object(j.jsxs)(I.Content,{children:[f,m,p,b]}),y]})}}]),n}(r.Component),M=function(e){var t=e.rateList,n=e.changeRateList;return Object(j.jsx)(I.Content,{children:Object(j.jsx)(d,{children:function(e){return t.map((function(t){var r=t.id;return Object(j.jsx)(_,{item:t,genresList:e,changeRateList:n},r)}))}})})},U=n(122),J=U.a.TabPane,q=function(e){Object(h.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).state={searchQuery:null,numberPage:1,genresList:[],rateList:[]},e.onInputChange=function(t){e.setState({searchQuery:t.target.value,numberPage:1})},e.onPageChange=function(t){e.setState({numberPage:t})},e.changeRateList=function(){k.getRatedFilms().then((function(t){e.setState({rateList:Object(c.a)(t.results)})}))},e.onTabClick=function(t){e.changeRateList()},e}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this;k.getGenres().then((function(t){e.setState({genresList:Object(c.a)(t)})})),JSON.parse(localStorage.getItem("guestToken"))?this.changeRateList():k.creatGuestSession().then((function(e){localStorage.setItem("guestToken",JSON.stringify(e))}))}},{key:"render",value:function(){var e=this.state,t=e.searchQuery,n=e.numberPage,r=e.genresList,a=e.rateList;return Object(j.jsx)(p,{value:r,children:Object(j.jsx)("div",{className:"container",children:Object(j.jsx)(b.a,{children:Object(j.jsxs)(U.a,{defaultActiveKey:"1",onTabClick:this.onTabClick,children:[Object(j.jsxs)(J,{tab:"Search",children:[Object(j.jsx)(v,{onInputChange:this.onInputChange}),Object(j.jsx)(K,{searchQuery:t,numberPage:n,onPageChange:this.onPageChange,changeRateList:this.changeRateList,rateList:a})]},"1"),Object(j.jsx)(J,{tab:"Rated",children:Object(j.jsx)(M,{rateList:a,changeRateList:this.changeRateList})},"2")]})})})})}}]),n}(r.Component);i.a.render(Object(j.jsx)(q,{}),document.getElementById("root"))}},[[333,1,2]]]);
//# sourceMappingURL=main.e7ee9a8b.chunk.js.map